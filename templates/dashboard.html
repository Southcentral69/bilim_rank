{% extends "base.html" %}
{% block content %}

<style>
  .upload-panel {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 15px;
    align-items: center;
  }

  .upload-panel form {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .rating-badge {
    font-size: 0.9rem;
    padding: 6px 10px;
    border-radius: 12px;
    font-weight: 600;
  }

  /* –¶–≤–µ—Ç–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ */
  .r1 { background-color: #2ecc71; color: #fff; }
  .r2 { background-color: #27ae60; color: #fff; }
  .r3 { background-color: #f1c40f; color: #000; }
  .r4 { background-color: #f39c12; color: #fff; }
  .r5 { background-color: #e67e22; color: #fff; }
  .r6 { background-color: #e74c3c; color: #fff; }
  .r7 { background-color: #c0392b; color: #fff; }
  .r8 { background-color: #8e44ad; color: #fff; }
  .r9 { background-color: #6c3483; color: #fff; }

  .table thead th {
    background: #f8f9fa;
    border-bottom: 2px solid #dee2e6;
    font-weight: 600;
  }
</style>

<div class="upload-panel">
  <form action="{{ url_for('upload') }}" method="post" enctype="multipart/form-data">
    <input class="form-control form-control-sm" style="width:220px" type="file" name="file" multiple required>
    <button class="btn btn-primary btn-sm" type="submit">üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
  </form>

  <a href="{{ url_for('export_csv') }}" class="btn btn-outline-secondary btn-sm">‚¨áÔ∏è –≠–∫—Å–ø–æ—Ä—Ç CSV</a>
  <a href="{{ url_for('api_ratings') }}" class="btn btn-outline-info btn-sm">üåê API JSON</a>

  <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –≥–æ—Å—Ç–µ–≤–æ–≥–æ –≤—Ö–æ–¥–∞ -->
  {% if not current_user.is_authenticated %}
    <a href="{{ url_for('login_guest') }}" class="btn btn-outline-warning btn-sm">üë§ –í–æ–π—Ç–∏ –∫–∞–∫ –≥–æ—Å—Ç—å</a>
  {% endif %}
</div>

<div class="card shadow-sm">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover mb-0 align-middle">
        <thead class="table-light">
          <tr>
            <th style="width:90px;">–ú–µ—Å—Ç–æ</th>
            <th>–£—á–µ–Ω–∏–∫</th>
            <th style="width:130px;">–ö–ª–∞—Å—Å</th>
            <th style="width:130px;">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</th>
            <th style="width:150px;">–†–µ–π—Ç–∏–Ω–≥ (–ö–æ—Ä–µ—è)</th>
          </tr>
        </thead>
        <tbody>
          {% for s in students %}
          <tr>
            <td class="fw-bold text-center">{{ s.place }}</td>
            <td>{{ s.name if s.name else ('ID:' ~ s.external_id) }}</td>
            <td>{{ s.klass }}</td>
            <td>{{ '%.2f'|format(s.average) }}</td>
            <td>
              <span class="badge rating-badge r{{ s.korean_rating }}">{{ s.korean_rating }}</span>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="5" class="text-center text-muted py-3">
              –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö ‚Äî –∑–∞–≥—Ä—É–∑–∏—Ç–µ Excel-—Ñ–∞–π–ª—ã –∫–ª–∞—Å—Å–æ–≤ üìä
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% endblock %}
